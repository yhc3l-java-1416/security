!function(){var a=function(a,b){"use strict";var c,d,e;if(window.XMLHttpRequest||(window.XMLHttpRequest=function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(a){return null}}),"object"==typeof a&&(a.url&&(a.uri=a.url),a.method=a.method&&"string"==typeof a.method&&a.method.length>0?a.method.toUpperCase():"GET",a.body&&"object"==typeof a.body&&(a.body=JSON.stringify(a.body)),void 0===a.body&&(a.body=null)),d=new XMLHttpRequest,d.open(a.method,a.uri,!0),a.headers&&"object"==typeof a.headers)for(e in a.headers)a.headers.hasOwnProperty(e)&&d.setRequestHeader(e,a.headers[e]);(a.json&&"POST"===a.method||"PUT"===a.method)&&d.setRequestHeader("Content-type","application/json"),d.onreadystatechange=function(){if(4===d.readyState){var e=Number(String(d.status)[0]);0===e||4===e||5===e?b&&b("Server returned status code "+d.status,d,null):(c=a.json?JSON.parse(d.responseText):d.responseText,b&&b(null,d,c))}},d.send(a.body)},b=window.location.origin,c={};c.getAll=function(c){a({url:b+"/waitinglist",method:"GET",json:!0},function(a,b,d){null===a&&c(null,d)})},c.item={},c.item.get=function(c,d){a({url:b+"/waitinglist/"+c,method:"GET",json:!0},function(a,b,c){null===a&&d(null,c)})},c.item.create=function(c,d){a({url:b+"/waitinglist",method:"POST",body:JSON.stringify(c),json:!0},function(a,b,c){null===a&&d(null,c)})},c.item.update=function(c,d,e){a({url:b+"/waitinglist/"+c,method:"PUT",body:JSON.stringify(d),json:!0},function(a,b,c){null===a&&e(null,c)})},c.item.remove=function(c,d){a({url:b+"/waitinglist/"+c,method:"DELETE",json:!0},function(a,b,c){null===a&&d(null,c)})},$(function(){"use strict";var a,b=[],d=document.querySelector("audio"),e=function(){d.load(),d.play()},f=!1;void 0===localStorage.username?($("#userInfo").show(),$("#list").hide()):($("#user").text(localStorage.username),$("#userInfo").hide(),$("#list").show()),$("#save").click(function(){localStorage.username=$("#username").val(),$("#user").text(localStorage.username),$("#userInfo").hide(),$("#list").show()}),a=function(d){c.getAll(function(f,g){var h,i,j,k,l,m,n=[];if(g=g.filter(function(){var a={};return function(b){var c=b.name;return 1===a[c]?0:a[c]=1}}()),g.forEach(function(a){n.push(a.name)}),j=function(a){$("#waitingList li:nth-child("+(a+1)+")").remove(),b.splice(a,1)},k=function(a,c){var d=b.splice(a,1);b.splice(c,0,d[0]),0===c?$("#waitingList li:nth-child("+(a+1)+")").insertBefore($("#waitingList li:nth-child(1)")):$("#waitingList li:nth-child("+(a+1)+")").insertAfter($("#waitingList li:nth-child("+c+")"))},i=function(d,f){var g=$('<li class="new-item">'),i=$("<span>"),j=$('<button class="icon-trash delete-button">');i.text(f.name),g.append(i),(localStorage.username===f.name||"Tom"===localStorage.username)&&(j.click(function(){c.item.remove(f.id,function(){a()})}),g.append(j)),d<b.length?g.insertAfter($("#waitingList li:nth-child("+d+")")):h.append(g),"Tom"===localStorage.username&&e(),b.splice(d,0,f.name)},null===f)for(h=$("#waitingList"),b.forEach(function(a){m=n.indexOf(a),-1===m&&j(b.indexOf(a))}),l=0;l<g.length;l+=1)m=b.indexOf(n[l]),-1===m?i(l,g[l]):m!==l&&k(m,l);"function"==typeof d&&d()})},$("#addButton").click(function(){if(-1!==b.indexOf(localStorage.username)||f)$("#alreadyListed").show(),setTimeout(function(){$("#alreadyListed").hide()},3e3);else{var d={};d.name=localStorage.username,f=!0,c.item.create(d,function(b){null===b&&a(function(){f=!1})})}}),$("#resetUser").click(function(){$("#userInfo").show(),$("#list").hide()}),setInterval(function(){a()},4e3),a()})}();